# Task: Fix MockNetworkClient Actor Isolation Violation

Status: done

## Objective
Remove actor isolation violations in MockNetworkClient where `nonisolated` methods access mutable actor state through Tasks.

## Context
- Related files: `Sources/NetKit/Mock/MockNetworkClient.swift`
- Dependencies: None
- Severity: **HIGH** - Can cause data races in test code

## Problem
Upload/download methods at lines 269, 282, 345 are marked `nonisolated` but create Tasks that access isolated actor state (`stubs`, `callCounts`). This violates actor isolation guarantees.

## Steps
1. [x] Remove `nonisolated` keyword from upload methods
2. [x] Remove `nonisolated` keyword from download methods
3. [x] Restructure return types if needed to work with actor isolation
4. [x] Verify all MockNetworkClient public API remains usable
5. [x] Run all tests that use MockNetworkClient
6. [x] Add test specifically checking concurrent mock access

## Acceptance Criteria
- [x] No `nonisolated` methods that access actor state
- [x] All MockNetworkClient methods compile without warnings
- [x] Existing tests using MockNetworkClient pass
- [x] No data races detectable with Thread Sanitizer

## Notes
- May require restructuring how UploadResult/DownloadResult are created
- Consider if MockNetworkClient needs to be an actor at all
- Alternative: make it a class with explicit synchronization

## Solution
Changed the `NetworkClientProtocol` to make `upload` and `download` methods `async`. This allows the `MockNetworkClient` actor to properly conform to the protocol without using `nonisolated`, ensuring actor isolation guarantees are maintained. The change is a breaking API change but is the correct Swift 6 concurrency pattern.
